Version 4
SHEET 1 6564 2808
WIRE 2384 96 2336 96
WIRE 2576 96 2464 96
WIRE 96 160 -656 160
WIRE 96 208 96 160
WIRE 160 208 96 208
WIRE 464 224 224 224
WIRE 592 224 464 224
WIRE 816 224 672 224
WIRE 1264 224 816 224
WIRE 1408 240 1328 240
WIRE 1584 240 1408 240
WIRE 1920 240 1584 240
WIRE 1264 256 1168 256
WIRE 2064 256 1984 256
WIRE 2176 256 2064 256
WIRE 2336 256 2336 96
WIRE 2336 256 2256 256
WIRE 2400 256 2336 256
WIRE 160 272 96 272
WIRE 1920 272 1824 272
WIRE 2576 272 2576 96
WIRE 2576 272 2464 272
WIRE 2928 272 2576 272
WIRE 2400 288 2336 288
WIRE 3072 288 2992 288
WIRE 3264 288 3072 288
WIRE -656 304 -656 160
WIRE -656 304 -1056 304
WIRE -560 304 -656 304
WIRE -368 304 -480 304
WIRE -96 304 -368 304
WIRE 2928 304 2832 304
WIRE 96 320 96 272
WIRE 96 320 -32 320
WIRE -368 352 -368 304
WIRE 816 352 816 224
WIRE -96 368 -176 368
WIRE 1168 368 1168 256
WIRE 1232 368 1168 368
WIRE 1408 368 1408 240
WIRE 1408 368 1312 368
WIRE 1824 400 1824 272
WIRE 2064 400 2064 256
WIRE 2064 400 1824 400
WIRE -1136 432 -1216 432
WIRE 1168 432 1168 368
WIRE 2832 432 2832 304
WIRE 3072 432 3072 288
WIRE 3072 432 2832 432
WIRE -368 464 -368 416
WIRE -176 464 -176 368
WIRE 96 464 96 320
WIRE 144 464 96 464
WIRE 1920 464 1776 464
WIRE -1056 480 -1056 304
WIRE -1056 480 -1200 480
WIRE 2064 480 1984 480
WIRE 2176 480 2064 480
WIRE 2192 480 2176 480
WIRE 2336 480 2336 288
WIRE 2336 480 2256 480
WIRE 1920 496 1824 496
WIRE -1136 528 -1200 528
WIRE 816 528 816 416
WIRE 2336 544 2336 480
WIRE 1168 560 1168 512
WIRE -1136 576 -1216 576
WIRE 1824 608 1824 496
WIRE 2064 608 2064 480
WIRE 2064 608 1824 608
WIRE -1136 656 -1168 656
WIRE -1040 656 -1136 656
WIRE -592 656 -1040 656
WIRE 1168 672 1168 640
WIRE 2336 672 2336 624
WIRE 432 704 304 704
WIRE 224 720 224 704
WIRE 304 720 304 704
WIRE -1136 736 -1136 656
WIRE -928 752 -976 752
WIRE -592 752 -592 656
WIRE -592 752 -704 752
WIRE -544 752 -592 752
WIRE -416 752 -464 752
WIRE -384 752 -416 752
WIRE -272 752 -304 752
WIRE -240 752 -272 752
WIRE -144 752 -176 752
WIRE 400 752 336 752
WIRE -976 768 -976 752
WIRE -928 816 -976 816
WIRE -416 816 -416 752
WIRE -416 816 -704 816
WIRE 320 816 320 784
WIRE 432 816 432 704
WIRE 432 816 320 816
WIRE 224 848 224 800
WIRE 288 848 288 784
WIRE 288 848 224 848
WIRE 304 848 288 848
WIRE 400 848 400 752
WIRE 400 848 384 848
WIRE -1136 880 -1136 816
WIRE -1136 880 -1216 880
WIRE -928 880 -1136 880
WIRE -592 880 -704 880
WIRE -272 880 -272 752
WIRE -272 880 -592 880
WIRE 240 896 208 896
WIRE 336 896 320 896
WIRE 432 896 336 896
WIRE 304 928 240 928
WIRE -1040 944 -1040 656
WIRE -928 944 -1040 944
WIRE -640 944 -704 944
WIRE 432 944 432 896
WIRE -640 960 -640 944
WIRE 304 960 304 928
WIRE 336 960 336 896
WIRE -640 1040 -640 1024
WIRE 240 1040 240 928
WIRE 320 1040 320 1024
WIRE 320 1040 240 1040
WIRE 432 1040 432 1024
WIRE -976 1072 -976 816
WIRE -592 1072 -592 880
WIRE -592 1072 -976 1072
WIRE 208 1072 208 896
WIRE 352 1072 352 992
WIRE 352 1072 208 1072
WIRE 2960 1088 2928 1088
WIRE 3056 1088 2960 1088
WIRE 3136 1088 3056 1088
WIRE 3584 1088 3136 1088
WIRE 3648 1088 3584 1088
WIRE 3056 1104 3056 1088
WIRE 3136 1104 3136 1088
WIRE 3584 1104 3584 1088
WIRE 3344 1120 3328 1120
WIRE 3648 1120 3648 1088
WIRE 4272 1120 4224 1120
WIRE 4368 1120 4352 1120
WIRE 4384 1120 4368 1120
WIRE 4480 1120 4464 1120
WIRE 1280 1136 1168 1136
WIRE 1536 1136 1360 1136
WIRE 3344 1136 3296 1136
WIRE 3440 1136 3408 1136
WIRE 4480 1136 4480 1120
WIRE 3328 1152 3328 1120
WIRE 3344 1152 3328 1152
WIRE 3344 1168 3312 1168
WIRE 4576 1168 4528 1168
WIRE 3216 1184 3168 1184
WIRE 3296 1184 3296 1136
WIRE 3296 1184 3280 1184
WIRE 3328 1184 3328 1152
WIRE 3344 1184 3328 1184
WIRE 3504 1184 3504 1136
WIRE 3520 1184 3504 1184
WIRE 3536 1184 3520 1184
WIRE 4368 1184 4368 1120
WIRE 4384 1184 4368 1184
WIRE 3328 1200 3328 1184
WIRE 3360 1200 3360 1184
WIRE 3360 1200 3328 1200
WIRE 3216 1216 3200 1216
WIRE 3296 1216 3280 1216
WIRE 3360 1216 3360 1200
WIRE 3584 1216 3584 1200
WIRE 3648 1216 3648 1184
WIRE 3648 1216 3584 1216
WIRE 3680 1216 3648 1216
WIRE 3792 1216 3680 1216
WIRE 3888 1216 3872 1216
WIRE 4048 1216 3968 1216
WIRE 4272 1216 4048 1216
WIRE 4384 1216 4272 1216
WIRE 4464 1216 4448 1216
WIRE 1168 1232 1168 1136
WIRE 1280 1232 1168 1232
WIRE 1536 1232 1536 1136
WIRE 1536 1232 1344 1232
WIRE 3168 1232 3168 1184
WIRE 3168 1232 2720 1232
WIRE 3200 1232 3200 1216
WIRE 3216 1232 3200 1232
WIRE 3584 1232 3584 1216
WIRE -1136 1248 -1168 1248
WIRE -1040 1248 -1136 1248
WIRE -592 1248 -1040 1248
WIRE 3216 1248 3216 1232
WIRE 3344 1248 3328 1248
WIRE 3648 1248 3648 1216
WIRE 1840 1264 1776 1264
WIRE 2048 1264 1920 1264
WIRE 3296 1264 3296 1216
WIRE 3344 1264 3296 1264
WIRE 3440 1264 3408 1264
WIRE 4048 1264 4048 1216
WIRE 112 1280 48 1280
WIRE 256 1280 192 1280
WIRE 368 1280 256 1280
WIRE 2448 1280 2384 1280
WIRE 3328 1280 3328 1248
WIRE 3344 1280 3328 1280
WIRE 4528 1280 4528 1264
WIRE 2944 1296 2928 1296
WIRE 3008 1296 2944 1296
WIRE 3024 1296 3008 1296
WIRE 3136 1296 3104 1296
WIRE 3248 1296 3136 1296
WIRE 3312 1296 3312 1168
WIRE 3312 1296 3248 1296
WIRE 3344 1296 3312 1296
WIRE 3328 1312 3328 1280
WIRE 3344 1312 3328 1312
WIRE 3504 1312 3504 1264
WIRE 3520 1312 3504 1312
WIRE 3536 1312 3520 1312
WIRE -1136 1328 -1136 1248
WIRE 2928 1328 2928 1296
WIRE 3328 1328 3328 1312
WIRE 3360 1328 3360 1312
WIRE 3360 1328 3328 1328
WIRE -928 1344 -976 1344
WIRE -592 1344 -592 1248
WIRE -592 1344 -704 1344
WIRE -544 1344 -592 1344
WIRE -416 1344 -464 1344
WIRE -384 1344 -416 1344
WIRE -272 1344 -304 1344
WIRE -240 1344 -272 1344
WIRE -144 1344 -176 1344
WIRE 3360 1344 3360 1328
WIRE 3584 1344 3584 1328
WIRE 3648 1344 3648 1312
WIRE -976 1360 -976 1344
WIRE 256 1360 256 1280
WIRE 1040 1360 848 1360
WIRE 1168 1360 1168 1232
WIRE 1168 1360 1120 1360
WIRE 1280 1360 1168 1360
WIRE 2448 1360 2448 1280
WIRE 2480 1360 2448 1360
WIRE 1536 1376 1536 1232
WIRE 1536 1376 1344 1376
WIRE 1616 1376 1536 1376
WIRE 1776 1376 1776 1264
WIRE 1776 1376 1696 1376
WIRE 1840 1376 1776 1376
WIRE 2720 1376 2720 1232
WIRE 2720 1376 2544 1376
WIRE 1280 1392 1168 1392
WIRE 2048 1392 2048 1264
WIRE 2048 1392 1904 1392
WIRE 2240 1392 2048 1392
WIRE 2480 1392 2240 1392
WIRE 3136 1392 3136 1296
WIRE 4528 1392 3136 1392
WIRE 4576 1392 4576 1168
WIRE 4576 1392 4528 1392
WIRE -928 1408 -976 1408
WIRE -416 1408 -416 1344
WIRE -416 1408 -704 1408
WIRE 1840 1408 1776 1408
WIRE -1136 1472 -1136 1408
WIRE -1136 1472 -1152 1472
WIRE -928 1472 -1136 1472
WIRE -592 1472 -704 1472
WIRE -272 1472 -272 1344
WIRE -272 1472 -592 1472
WIRE 256 1488 256 1440
WIRE 1168 1504 1168 1392
WIRE 1616 1504 1552 1504
WIRE 1776 1504 1776 1408
WIRE 1776 1504 1696 1504
WIRE 1856 1504 1776 1504
WIRE 1984 1504 1936 1504
WIRE -1040 1536 -1040 1248
WIRE -928 1536 -1040 1536
WIRE -640 1536 -704 1536
WIRE -640 1552 -640 1536
WIRE -640 1632 -640 1616
WIRE -976 1664 -976 1408
WIRE -592 1664 -592 1472
WIRE -592 1664 -976 1664
WIRE 336 1664 304 1664
WIRE 448 1664 416 1664
FLAG 448 1664 0
FLAG -176 464 0
FLAG -368 464 0
FLAG 816 224 DC
FLAG 816 528 0
FLAG 464 224 Delay
FLAG 144 464 Digital_delayed
FLAG -368 304 Delayed
FLAG -976 768 0
FLAG -144 752 0
FLAG -640 1040 0
FLAG 32 1040 0
FLAG 32 832 0
FLAG 32 960 v-
FLAG 32 752 v+
FLAG -1200 528 WienOscillator
FLAG -1216 576 CrystalOscillator
FLAG 256 1488 0
FLAG 48 1280 5v
FLAG -1216 432 idealOscillator
FLAG -1200 480 555Oscillator
IOPIN -1200 480 In
FLAG -1216 880 555Oscillator
IOPIN -1216 880 Out
FLAG 1296 272 v+
FLAG 1296 208 v-
FLAG 1168 672 0
FLAG 1584 240 AmplifiedDC
FLAG 368 1280 PotOut
FLAG 1776 464 PotOut
FLAG 304 1664 idealOscillator
FLAG -1168 656 5v
FLAG 2432 240 v+
FLAG 2432 304 v-
FLAG 2336 672 0
FLAG 3264 288 DiffAmpOut
FLAG 1952 288 v+
FLAG 1952 224 v-
FLAG 1952 512 v+
FLAG 1952 448 v-
FLAG -976 1360 0
FLAG -144 1344 0
FLAG -640 1632 0
FLAG -1152 1472 555Oscillator25kHz
IOPIN -1152 1472 Out
FLAG -1168 1248 5v
FLAG 2384 1280 DiffAmpOut
FLAG 2512 1408 5v
FLAG 2512 1344 0
FLAG 2944 1296 Vp
FLAG 3680 1216 Mdrv
FLAG 3360 1216 0
FLAG 3440 1280 0
FLAG 3440 1152 0
FLAG 3520 1184 G1
FLAG 3520 1312 G2
FLAG 3360 1344 0
FLAG 4048 1344 0
FLAG 3584 1344 0
FLAG 2928 1408 0
FLAG 2928 1168 0
FLAG 2960 1088 Vpwr
FLAG 3008 1296 Vp
FLAG 3216 1248 0
FLAG 4384 1232 0
FLAG 4480 1136 0
FLAG 4224 1120 Vp
FLAG 4272 1216 Csns
FLAG 3056 1168 0
FLAG 3136 1168 0
FLAG 4528 1392 nOverC
FLAG 4528 1280 0
FLAG 3648 1344 0
FLAG 1312 1344 v+
FLAG 1312 1408 v-
FLAG 848 1360 555Oscillator25kHz
IOPIN 848 1360 In
FLAG 1168 1504 0
FLAG 1872 1360 v+
FLAG 1872 1424 v-
FLAG 2240 1392 25MHzTriangularOutput
FLAG 2960 320 v+
FLAG 2960 256 v-
FLAG 2720 1232 PWMOut
FLAG 3248 1296 Enable
FLAG 1984 1504 0
FLAG 1552 1504 -5v
FLAG 336 752 v+
FLAG 272 752 v-
FLAG 432 704 5v
FLAG 224 704 0
FLAG 288 992 v+
FLAG 352 992 v-
FLAG 240 1040 -5v
FLAG 432 1040 0
SYMBOL Digital\\xor -48 272 R0
WINDOW 3 -112 119 Left 2
SYMATTR Value Vhigh = 5 Trise = 10n Td = 10n
SYMATTR InstName XOR1
SYMBOL Digital\\xor 208 176 R0
WINDOW 3 -100 112 Left 2
SYMATTR Value Vhigh = 5 Trise = 10n Td = 10n
SYMATTR InstName XOR2
SYMBOL voltage 320 1664 R270
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 59 -320 VRight 2
WINDOW 0 22 86 VRight 2
SYMATTR Value PULSE(0 5 0 0.001u 0.001u 4.999u 10u)
SYMATTR InstName V1
SYMBOL res -464 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rd1
SYMATTR Value 1k
SYMBOL cap -384 352 R0
SYMATTR InstName Cd1
SYMATTR Value {waterlevel}
SYMBOL res 688 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rlp1
SYMATTR Value 15k
SYMBOL cap 800 352 R0
SYMATTR InstName Clp1
SYMATTR Value 10n
SYMBOL Misc\\NE555 -816 848 R0
SYMATTR InstName U1
SYMBOL res -448 736 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RA
SYMATTR Value 1k
SYMBOL res -288 736 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RB
SYMATTR Value 6.8k
SYMBOL cap -176 736 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cosc
SYMATTR Value 0.001µ
SYMBOL res -1152 720 R0
SYMATTR InstName RLosc
SYMATTR Value 1k
SYMBOL cap -656 960 R0
SYMATTR InstName Ccontrol
SYMATTR Value 0.01µ
SYMBOL voltage 32 944 R0
SYMATTR InstName V3
SYMATTR Value -15
SYMBOL voltage 32 736 R0
SYMATTR InstName V4
SYMATTR Value 15
SYMBOL res 208 1264 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rpot1
SYMATTR Value 2k
SYMBOL res 272 1456 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Rpot2
SYMATTR Value 8k
SYMBOL OpAmps\\AD795 1296 304 M180
SYMATTR InstName U6
SYMBOL res 1184 416 M0
SYMATTR InstName Ramp1
SYMATTR Value 10k
SYMBOL res 1328 384 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Ramp2
SYMATTR Value 330k
SYMBOL voltage 1168 544 R0
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Voffset
SYMATTR Value 65m
SYMBOL res 2272 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdiff2
SYMATTR Value 10k
SYMBOL res 2352 640 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName Rdiff4
SYMATTR Value 10k
SYMBOL OpAmps\\AD795 2432 208 R0
SYMATTR InstName DiffAmp
SYMBOL res 2272 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdiff1
SYMATTR Value 10k
SYMBOL res 2480 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdiff3
SYMATTR Value 10k
SYMBOL OpAmps\\AD795 1952 320 M180
SYMATTR InstName Buffer2
SYMBOL OpAmps\\AD795 1952 544 M180
SYMATTR InstName Buffer1
SYMBOL Misc\\NE555 -816 1440 R0
SYMATTR InstName U4
SYMBOL res -448 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RA1
SYMATTR Value 4k
SYMBOL res -288 1328 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RB1
SYMATTR Value 27.2k
SYMBOL cap -176 1328 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cosc1
SYMATTR Value 0.001µ
SYMBOL res -1152 1312 R0
SYMATTR InstName RLosc1
SYMATTR Value 1k
SYMBOL cap -656 1552 R0
SYMATTR InstName Ccontrol1
SYMATTR Value 0.01µ
SYMBOL Opamps\\AD8030 2512 1440 M180
SYMATTR InstName U8
SYMBOL nmos 3536 1232 R0
WINDOW 3 -57 98 Left 2
WINDOW 0 52 32 Left 2
SYMATTR Value FDS4410
SYMATTR InstName M1
SYMBOL nmos 3536 1104 R0
WINDOW 3 -59 96 Left 2
WINDOW 0 52 32 Left 2
SYMATTR Value FDS4410
SYMATTR InstName M2
SYMBOL Digital\\buf1 3440 1072 R0
WINDOW 0 -5 38 Left 2
WINDOW 3 8 60 Invisible 2
SYMATTR InstName MD1
SYMATTR Value Ref=2.5 Vhigh=15 Trise=50n Td=10n
SYMBOL Digital\\and 3376 1088 R0
WINDOW 0 -24 63 Left 2
WINDOW 3 16 52 Invisible 2
SYMATTR InstName A1
SYMATTR Value Vhigh=5 Trise=100n Tfall=10n Td=10n
SYMBOL Digital\\and 3376 1216 R0
WINDOW 0 -24 64 Left 2
WINDOW 3 16 52 Invisible 2
SYMATTR InstName A2
SYMATTR Value Vhigh=5 Trise=100n Tfall=10n Td=10n
SYMBOL ind 3776 1232 R270
WINDOW 0 32 33 VTop 2
WINDOW 3 32 81 VTop 2
SYMATTR InstName Lm1
SYMATTR Value 1m
SYMBOL res 3872 1232 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Rm1
SYMATTR Value 4
SYMBOL Digital\\buf1 3440 1200 R0
WINDOW 0 -5 38 Left 2
WINDOW 3 8 60 Invisible 2
SYMATTR InstName MD2
SYMATTR Value Ref=2.5 Vhigh=5 Trise=50n Td=10n
SYMBOL voltage 2928 1312 R0
WINDOW 0 34 48 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 34 70 Left 2
SYMATTR InstName Vp1
SYMATTR Value 5V
SYMBOL voltage 2928 1072 R0
WINDOW 0 37 51 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 36 71 Left 2
SYMATTR InstName Vpwr1
SYMATTR Value 10V
SYMBOL Digital\\diffschmitt 3216 1136 R0
WINDOW 3 8 120 Invisible 2
WINDOW 0 23 34 Left 2
SYMATTR Value Vhigh=5 Trise=10n Td=10n
SYMATTR InstName A3
SYMBOL res 4064 1248 M0
WINDOW 0 -58 42 Left 2
WINDOW 3 -47 65 Left 2
SYMATTR InstName Rcs1
SYMATTR Value 0.1
SYMBOL Digital\\diffschmitt 4384 1136 R0
WINDOW 3 8 120 Invisible 2
WINDOW 0 23 34 Left 2
SYMATTR Value Vt=0 Vh=1m Vhigh=5 Trise=10n Td=10n
SYMATTR InstName A4
SYMBOL polcap 3040 1104 R0
WINDOW 0 21 16 Left 2
WINDOW 3 21 48 Left 2
SYMATTR InstName C1
SYMATTR Value 100µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=25 Irms=370m Rser=0.24 Lser=0 mfg="Nichicon" pn="UPL1E101MPH" type="Al electrolytic"
SYMBOL cap 3120 1104 R0
WINDOW 0 21 16 Left 2
WINDOW 3 21 48 Left 2
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL res 3120 1312 M270
WINDOW 0 30 71 VTop 2
WINDOW 3 30 36 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res 4480 1136 M270
WINDOW 0 30 71 VTop 2
WINDOW 3 30 36 VTop 2
SYMATTR InstName R2
SYMATTR Value 200
SYMBOL npn 4464 1168 R0
WINDOW 0 -10 69 Left 2
WINDOW 3 -31 93 Left 2
SYMATTR InstName Q1
SYMATTR Value BC547B
SYMBOL res 4368 1136 M270
WINDOW 0 30 87 VTop 2
WINDOW 3 30 36 VTop 2
SYMATTR InstName R8
SYMATTR Value 4.7k
SYMBOL schottky 3632 1184 M180
WINDOW 0 39 32 Left 2
WINDOW 3 21 9 Left 2
SYMATTR InstName D3
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 3632 1312 M180
WINDOW 0 39 32 Left 2
WINDOW 3 21 9 Left 2
SYMATTR InstName D4
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 1136 1344 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 22k
SYMBOL OpAmps\\AD795 1312 1312 R0
SYMATTR InstName integrator1
SYMBOL cap 1344 1216 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL res 1376 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 22k
SYMBOL res 1936 1248 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 30k
SYMBOL OpAmps\\AD795 1872 1328 R0
SYMATTR InstName U7
SYMBOL res 1600 1360 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 22k
SYMBOL OpAmps\\AD795 2960 352 M180
SYMATTR InstName Buffer3
SYMBOL res 1712 1488 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdiv3
SYMATTR Value 51k
SYMBOL res 1952 1488 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdiv4
SYMATTR Value 11k
SYMBOL res 240 816 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 5k
SYMBOL res 400 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL Opamps\\AD8030 368 752 M270
WINDOW 3 -43 103 VLeft 2
SYMATTR InstName U2
SYMBOL res 416 928 R0
SYMATTR InstName R7
SYMATTR Value 5k
SYMBOL res 224 912 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL Opamps\\AD8030 256 992 M90
WINDOW 3 -43 103 VLeft 2
SYMATTR InstName U5
TEXT -1008 424 Left 2 !.tran 1ms startup
TEXT -648 -16 Left 2 ;This circuit convert detected capacitance change information to DC signal with:\n- Make a delayed signal with different capacitance values\n- Convert this to digital, via an xor gate\n- Use the difference in this digital signal and the oscillator to find only the delay signal (to find difference, an xor is used)\n- Finally the delay signal (like a pwm signal) can be converted to dc via a basic low pass filter
TEXT -648 -72 Left 4 ;1. Water Level Detection
TEXT -1008 504 Left 2 ;.between 5cm to 15cm with 2cm steps
TEXT 544 296 Left 2 ;fc = 1.061kHz\nripple is max 5mV\nsettling time 0.6ms
TEXT 16 1168 Left 3 ;Potentiometer equivalent
TEXT -576 696 Left 1 ;*Values selected from datasheet quick determination graphs
TEXT -1392 376 Left 3 ;Oscillator circuits
TEXT -1376 88 Left 5 ;-Water Level Controller-\n-Barbaros-\n-Emre-\n-Ahmet-
TEXT 1208 448 Left 2 ;Non-inverting Amplifier w/ NegativeDC\nGain = 330/10 + 1 = 34\n94-182mV - 94mV ->  1.1 - 3.99V
TEXT 1168 -16 Left 2 ;This circuit converts water level information to desired water amount information with:\n- Amplifying the DC voltage to an relatable potentiometer voltage level\n- Using voltage divider for potentiometer, we get the desired water level information\n- With differential amplifier, circuit gives us the how much water we need
TEXT 1168 -72 Left 4 ;2. Error Amplifier
TEXT 88 648 Left 4 ;Power Suppliers
TEXT -464 984 Left 4 ;555 Oscillator
TEXT 2360 376 Left 2 ;Differential Amplifier with equal R's\nDiffAmpOut = PotOut - AmplifiedDC
TEXT 304 1392 Left 3 ;Rtot = 10k
TEXT -576 1288 Left 1 ;*Values selected from datasheet quick determination graphs
TEXT -464 1576 Left 4 ;555 Oscillator
TEXT 3792 1240 Left 2 !.ic I(Lm)=0
TEXT 2856 912 Left 2 ;Half Bridge Driver:\nTwo or more of the drivers\n in driver IC can be used in \nparallel to increase current output.
TEXT 3760 1080 Left 2 ;Inductive load that \nmodels motor winding.
TEXT 4184 928 Left 2 ;Over-current protection:\nVoltage on Rcs current-sense \nresistor is compared with the \nthreshold set by R5 and R6.
TEXT 4176 1328 Left 2 ;LM311 or LM393 comparator \nwith open-collector output
TEXT 3288 944 Left 1 ;D1 and D2 are required to circulate the \nload current when both of the driver \ntransistors are OFF.  Otherwise, voltage \nat Mdrv can be very high due to Lm*di/dt.
TEXT 1232 1064 Left 2 ;integrator-triangle generator
TEXT -1008 464 Left 2 !.step param waterlevel 120p 255p 27p
TEXT -1008 376 Left 3 ;Simulation Settings
TEXT 1152 912 Left 2 ;This circuit generates PWM signal with different duty cycles depend on desired water amount with:\n- Generates a triangle signal at the integrator circuit\n- Amplifing and inverting the output for use at comparator\n- Comparing desired water amount and the triangle signal to generate PWM
TEXT 1152 856 Left 4 ;3. PWM Generation
TEXT 2856 856 Left 4 ;4. Motor Driver
RECTANGLE Normal 528 1712 -48 1568 2
RECTANGLE Normal -80 1120 -1408 608 2
RECTANGLE Normal 528 1536 -48 1136 2
RECTANGLE Normal 528 1104 -48 608 2
RECTANGLE Normal -80 1712 -1408 1152 2
RECTANGLE Normal 3616 1440 2848 1024 1
RECTANGLE Normal 4000 1312 3760 1136 1
RECTANGLE Normal 4560 1312 4176 1040 1
